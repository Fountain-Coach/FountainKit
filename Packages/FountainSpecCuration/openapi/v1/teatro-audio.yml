openapi: 3.1.0
info:
  title: Teatro Audio Service
  version: 0.1.0
  summary: 3D audio worlds, listeners, and sources for the Teatro Game Engine.
  description: |
    The Teatro Audio Service describes the spatial audio half of the Teatro Game Engine.
    It is responsible for managing audio worlds, listeners, and sound sources, and for
    computing per-frame audio mixes that a runtime backend can render.

    This spec is written for humans and LLMs and explains the mental model of engine audio:

    - AudioWorld: a logical audio context bound to a game session (and optionally a scene).
      It owns listeners and sources and tracks global settings such as master volume.
    - Listener: an ear or microphone in 3D space. Games usually have one listener
      bound to the player, but multi-listener setups (for example splitscreen) are possible.
    - AudioSource: a sound-emitting object. Each source references an AudioClipAsset
      (from the Teatro Assets Service), has spatial attributes (position, velocity),
      and playback parameters (looping, volume).
    - AudioMix: a snapshot of what should be heard this frame: which sources are audible,
      their gains/pans for each output channel, and which clips are playing.

    The Audio Service does not stream raw PCM here; it describes what should be played
    and how it should be spatialised. A concrete audio backend consumes the AudioMix
    and produces actual samples.
  license:
    name: FountainAI Internal
    url: https://fountain.coach/internal
servers:
  - url: http://127.0.0.1:0
    description: Logical Teatro Audio host (embedded or via Tools Factory)

tags:
  - name: audio-worlds
    description: Manage audio worlds and their attachment to sessions and scenes.
  - name: listeners
    description: Manage audio listeners within a world.
  - name: sources
    description: Manage audio sources within a world.
  - name: mixes
    description: Build per-frame audio mix descriptions.

paths:
  /audio-worlds:
    post:
      tags: [audio-worlds]
      operationId: teatro.audio.createAudioWorld
      summary: Create an audio world
      description: |
        Creates a new audio world bound to a game session (and optionally a scene).
        The audio world owns listeners and sources and tracks global audio settings.
      x-fountain.visibility: public
      x-fountain.reason: define spatial audio world for a game session
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAudioWorldRequest'
      responses:
        '201':
          description: Audio world created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioWorld'
        '400':
          description: Invalid audio world configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /audio-worlds/{audioWorldId}:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
    get:
      tags: [audio-worlds]
      operationId: teatro.audio.getAudioWorld
      summary: Get an audio world
      description: |
        Returns configuration and state for an audio world, including which
        session and scene it is attached to and master volume.
      x-fountain.visibility: public
      x-fountain.reason: inspect audio world configuration and global settings
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '200':
          description: Audio world details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioWorld'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [audio-worlds]
      operationId: teatro.audio.updateAudioWorld
      summary: Update an audio world
      description: |
        Updates global audio settings for a world, such as master volume or
        output configuration.
      x-fountain.visibility: public
      x-fountain.reason: tweak master audio settings for a world
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAudioWorldRequest'
      responses:
        '200':
          description: Updated audio world
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioWorld'
        '400':
          description: Invalid audio world update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [audio-worlds]
      operationId: teatro.audio.deleteAudioWorld
      summary: Delete an audio world
      description: |
        Deletes an audio world and all listeners and sources associated with it.
        The underlying game session and scene are not affected.
      x-fountain.visibility: public
      x-fountain.reason: remove audio world and its listeners and sources
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '204':
          description: Audio world deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /audio-worlds/{audioWorldId}/listeners:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
    get:
      tags: [listeners]
      operationId: teatro.audio.listListeners
      summary: List listeners in an audio world
      description: |
        Returns all audio listeners in the audio world. Each listener has a
        transform and can be associated with a game entity.
      x-fountain.visibility: public
      x-fountain.reason: inspect audio listeners configured for an audio world
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '200':
          description: List of listeners
          content:
            application/json:
              schema:
                type: object
                properties:
                  listeners:
                    type: array
                    items:
                      $ref: '#/components/schemas/AudioListener'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [listeners]
      operationId: teatro.audio.createListener
      summary: Create a listener in an audio world
      description: |
        Creates a new audio listener. A listener represents an ear or microphone
        that hears sounds from sources in the audio world.
      x-fountain.visibility: public
      x-fountain.reason: add spatial audio listener bound to player or camera
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAudioListenerRequest'
      responses:
        '201':
          description: Listener created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioListener'
        '400':
          description: Invalid listener configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /audio-worlds/{audioWorldId}/listeners/{listenerId}:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
      - $ref: '#/components/parameters/ListenerId'
    get:
      tags: [listeners]
      operationId: teatro.audio.getListener
      summary: Get a listener
      description: |
        Returns configuration and current transform for a listener in the
        audio world.
      x-fountain.visibility: public
      x-fountain.reason: inspect listener transform and entity binding
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '200':
          description: Listener details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioListener'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [listeners]
      operationId: teatro.audio.updateListener
      summary: Update a listener
      description: |
        Updates listener properties such as transform, entity binding, or
        whether it is active.
      x-fountain.visibility: public
      x-fountain.reason: move listener or retarget it to a different entity
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAudioListenerRequest'
      responses:
        '200':
          description: Updated listener
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioListener'
        '400':
          description: Invalid listener update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [listeners]
      operationId: teatro.audio.deleteListener
      summary: Delete a listener
      description: |
        Deletes a listener from the audio world. Sources remain unaffected.
      x-fountain.visibility: public
      x-fountain.reason: remove audio listener from world
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '204':
          description: Listener deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /audio-worlds/{audioWorldId}/sources:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
    get:
      tags: [sources]
      operationId: teatro.audio.listSources
      summary: List audio sources in an audio world
      description: |
        Returns all audio sources in the audio world. Each source references
        an AudioClipAsset and may be bound to a game entity.
      x-fountain.visibility: public
      x-fountain.reason: inspect audio sources configured for an audio world
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '200':
          description: List of audio sources
          content:
            application/json:
              schema:
                type: object
                properties:
                  sources:
                    type: array
                    items:
                      $ref: '#/components/schemas/AudioSource'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags: [sources]
      operationId: teatro.audio.createSource
      summary: Create an audio source
      description: |
        Creates a new audio source. A source can be spatial (positioned in
        3D) or non-spatial (UI or music). It references an AudioClipAsset id
        from the Teatro Assets Service.
      x-fountain.visibility: public
      x-fountain.reason: create sound source bound to clip and entity
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAudioSourceRequest'
      responses:
        '201':
          description: Audio source created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioSource'
        '400':
          description: Invalid audio source configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

  /audio-worlds/{audioWorldId}/sources/{sourceId}:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
      - $ref: '#/components/parameters/SourceId'
    get:
      tags: [sources]
      operationId: teatro.audio.getSource
      summary: Get an audio source
      description: |
        Returns configuration and current playback state for an audio source.
      x-fountain.visibility: public
      x-fountain.reason: inspect audio source binding, clip, and playback state
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '200':
          description: Audio source details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioSource'
        '404':
          $ref: '#/components/responses/NotFound'
    patch:
      tags: [sources]
      operationId: teatro.audio.updateSource
      summary: Update an audio source
      description: |
        Updates source properties such as volume, looping, spatial parameters,
        or playback commands (play/stop/pause).
      x-fountain.visibility: public
      x-fountain.reason: change audio source parameters or playback state
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAudioSourceRequest'
      responses:
        '200':
          description: Updated audio source
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioSource'
        '400':
          description: Invalid audio source update
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags: [sources]
      operationId: teatro.audio.deleteSource
      summary: Delete an audio source
      description: |
        Deletes an audio source from the world and stops playback for that
        source.
      x-fountain.visibility: public
      x-fountain.reason: remove audio source and stop sound
      x-fountain.allow-as-tool: true
      security: []
      responses:
        '204':
          description: Audio source deleted successfully
        '404':
          $ref: '#/components/responses/NotFound'

  /audio-worlds/{audioWorldId}/mix:
    parameters:
      - $ref: '#/components/parameters/AudioWorldId'
    post:
      tags: [mixes]
      operationId: teatro.audio.buildMix
      summary: Build an audio mix description
      description: |
        Builds an audio mix description for the world. The mix captures which
        sources are audible to each listener and the per-channel gain/pan
        that a backend should apply.

        This endpoint models the audio half of the game loop. Audio backends
        can consume the AudioMix object to render sound, and tests can inspect
        it to verify that sources are audible or muted as expected.
      x-fountain.visibility: public
      x-fountain.reason: compute logical audio mix for a frame
      x-fountain.allow-as-tool: true
      security: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AudioMixRequest'
      responses:
        '200':
          description: Audio mix description for this world
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AudioMix'
        '400':
          description: Invalid mix request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  parameters:
    AudioWorldId:
      name: audioWorldId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of an audio world.
    ListenerId:
      name: listenerId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of an audio listener within a world.
    SourceId:
      name: sourceId
      in: path
      required: true
      schema:
        type: string
      description: Unique identifier of an audio source within a world.

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

  schemas:
    Vector3:
      type: object
      description: 3D vector used for positions and velocities.
      required:
        - x
        - y
        - z
      properties:
        x:
          type: number
          format: float
        y:
          type: number
          format: float
        z:
          type: number
          format: float

    AudioWorld:
      type: object
      description: |
        Represents an audio world bound to a game session and optional scene.
        It owns listeners and sources and tracks global audio configuration.
      required:
        - id
        - sessionId
      properties:
        id:
          type: string
        sessionId:
          type: string
        sceneId:
          type: string
          description: Optional identifier of the scene this audio world is attached to.
        name:
          type: string
          description: Optional human-readable name for the audio world.
        masterVolume:
          type: number
          format: float
          description: Master volume multiplier for this world (0 = silent, 1 = default).

    CreateAudioWorldRequest:
      type: object
      description: Parameters required to create an audio world.
      required:
        - sessionId
      properties:
        sessionId:
          type: string
        sceneId:
          type: string
        name:
          type: string
        masterVolume:
          type: number
          format: float

    UpdateAudioWorldRequest:
      type: object
      description: Fields that can be updated on an audio world.
      properties:
        sceneId:
          type: string
        name:
          type: string
        masterVolume:
          type: number
          format: float

    AudioListener:
      type: object
      description: |
        Represents an audio listener in a world. The listener hears sound
        from sources and may be bound to a game entity (for example the player).
      required:
        - id
        - audioWorldId
      properties:
        id:
          type: string
        audioWorldId:
          type: string
        entityId:
          type: string
          description: Optional game entity id this listener is bound to.
        position:
          $ref: '#/components/schemas/Vector3'
        forward:
          $ref: '#/components/schemas/Vector3'
        up:
          $ref: '#/components/schemas/Vector3'
        isActive:
          type: boolean
          description: Whether this listener is active when building mixes.

    CreateAudioListenerRequest:
      type: object
      description: Parameters required to create a listener.
      properties:
        entityId:
          type: string
        position:
          $ref: '#/components/schemas/Vector3'
        forward:
          $ref: '#/components/schemas/Vector3'
        up:
          $ref: '#/components/schemas/Vector3'
        isActive:
          type: boolean

    UpdateAudioListenerRequest:
      type: object
      description: Fields that can be updated on a listener.
      properties:
        entityId:
          type: string
        position:
          $ref: '#/components/schemas/Vector3'
        forward:
          $ref: '#/components/schemas/Vector3'
        up:
          $ref: '#/components/schemas/Vector3'
        isActive:
          type: boolean

    AudioSourceKind:
      type: string
      description: |
        Describes how the source behaves spatially.
        - spatial: positioned in 3D and affected by listener position.
        - nonSpatial: UI or music; not spatialised.
      enum:
        - spatial
        - nonSpatial

    AudioSourcePlaybackState:
      type: string
      description: Current playback state for an audio source.
      enum:
        - stopped
        - playing
        - paused

    AudioSource:
      type: object
      description: |
        Represents an audio source in a world. Each source references an
        AudioClipAsset (from the Assets Service) and has playback parameters.
      required:
        - id
        - audioWorldId
        - kind
        - playbackState
      properties:
        id:
          type: string
        audioWorldId:
          type: string
        entityId:
          type: string
          description: Optional game entity id this source is bound to.
        kind:
          $ref: '#/components/schemas/AudioSourceKind'
        clipId:
          type: string
          description: Identifier of the AudioClipAsset to play.
        position:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
        volume:
          type: number
          format: float
          description: Per-source volume multiplier (0 = silent, 1 = default).
        loop:
          type: boolean
          description: Whether the clip should loop when it reaches the end.
        playbackState:
          $ref: '#/components/schemas/AudioSourcePlaybackState'

    CreateAudioSourceRequest:
      type: object
      description: Parameters required to create an audio source.
      required:
        - kind
        - clipId
      properties:
        entityId:
          type: string
        kind:
          $ref: '#/components/schemas/AudioSourceKind'
        clipId:
          type: string
        position:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
        volume:
          type: number
          format: float
        loop:
          type: boolean

    UpdateAudioSourceRequest:
      type: object
      description: Fields that can be updated on an audio source.
      properties:
        entityId:
          type: string
        kind:
          $ref: '#/components/schemas/AudioSourceKind'
        clipId:
          type: string
        position:
          $ref: '#/components/schemas/Vector3'
        velocity:
          $ref: '#/components/schemas/Vector3'
        volume:
          type: number
          format: float
        loop:
          type: boolean
        playbackCommand:
          type: string
          description: |
            Optional playback command to apply when updating the source.
            - play: start or resume playback.
            - stop: stop playback and reset position.
            - pause: pause playback without resetting position.
          enum:
            - play
            - stop
            - pause

    AudioMixRequest:
      type: object
      description: |
        Parameters controlling how an audio mix should be built. In most cases
        this can be left empty, but tests may request additional detail.
      properties:
        includePerSourceDetail:
          type: boolean
          description: Whether to include detailed per-source mix data.

    AudioMixSourceContribution:
      type: object
      description: |
        Contribution of a single source to the final mix for one listener.
        It records per-channel gains so backends can apply pan and volume.
      required:
        - sourceId
        - clipId
        - channelGains
      properties:
        sourceId:
          type: string
        clipId:
          type: string
        channelGains:
          type: array
          description: Gain for each output channel (for example [L, R] for stereo).
          items:
            type: number
            format: float

    AudioMix:
      type: object
      description: |
        Logical description of an audio mix for a world. It captures which
        sources are audible to which listeners and how loud they are on each
        output channel.
      required:
        - audioWorldId
      properties:
        audioWorldId:
          type: string
        listenerMixes:
          type: array
          description: Optional per-listener mixes.
          items:
            type: object
            required:
              - listenerId
              - sources
            properties:
              listenerId:
                type: string
              sources:
                type: array
                items:
                  $ref: '#/components/schemas/AudioMixSourceContribution'

    ErrorResponse:
      type: object
      description: Standard error response with human-readable message.
      properties:
        code:
          type: string
        message:
          type: string

