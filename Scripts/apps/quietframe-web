#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<EOF
quietframe-web â€” Vite dev server for QuietFrame playground (web)

Usage:
  quietframe-web dev [--port 5175]
  quietframe-web build
  quietframe-web preview

Notes:
  - Static output goes to Public/quietframe-web/dist and is served by publishing-frontend
  - Dev server proxies /api/qf/* to PublishingFrontend which forwards to the sidecar
EOF
}

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
WEB_DIR="$ROOT/Public/quietframe-web"

case "${1-}" in
  dev)
    shift
    cd "$WEB_DIR"
    if [[ ! -d node_modules ]]; then
      echo "Installing dependenciesâ€¦"
      if [[ -f package-lock.json ]]; then npm ci; else npm install; fi
    fi
    PORT="${1:-5175}"
    VITE_PORT="$PORT" npm run dev -- --port "$PORT" ;;
  build)
    cd "$WEB_DIR"; npm run build ;;
  preview)
    cd "$WEB_DIR"; npm run preview ;;
  -h|--help|help|*) usage ;;
esac
