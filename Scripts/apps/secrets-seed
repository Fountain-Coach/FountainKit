#!/usr/bin/env bash
set -euo pipefail

# Convenience wrapper for seeding SecretStore headers into FountainStore.
# Usage:
#   Scripts/apps/secrets-seed --agent-id <fountain.coach/agent/...> [--corpus secrets] \
#                            [--header NAME=VALUE]... [--file headers.json]

ROOT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")"/../.. && pwd)
PKG="$ROOT_DIR/Packages/FountainApps"
export FOUNTAIN_SKIP_LAUNCHER_SIG=1

if [[ $# -eq 0 ]]; then
  cat >&2 <<'USAGE'
Usage: Scripts/apps/secrets-seed --agent-id <fountain.coach/agent/...> [--corpus secrets]
       [--header NAME=VALUE]... [--file headers.json]

Examples:
  Scripts/apps/secrets-seed --agent-id fountain.coach/agent/tools-factory/service \
      --header Authorization="Bearer sk-..." --header X-API-Key=abc123

  Scripts/apps/secrets-seed --agent-id fountain.coach/agent/gateway/service \
      --file /path/to/headers.json
USAGE
  exit 2
fi

exec swift run --package-path "$PKG" -c "${CONFIGURATION:-debug}" secrets-seed "$@"

