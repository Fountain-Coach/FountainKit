# FountainAI Specs Audit — 2025-11-11

What
- Scope: full contents of `specs/` — `specs/AGENTS.md`, `specs/README.md`, `specs/Migration Plan.md`, `specs/schemas/agent-descriptor.schema.json`.
- Basis: repo state at commit 12d356a.

Why
- Establish a versionable baseline review of the Interoperability Contract, schema, and migration plan to guide near-term fixes and long-term evolution.

How
- Verbatim conclusions from agent audit, refactored for repository context and with file anchors for follow-up.

Where
- Contract: `specs/AGENTS.md:1`
- Schema: `specs/schemas/agent-descriptor.schema.json:1`
- Migration plan: `specs/Migration Plan.md:1`
- README pointers: `specs/README.md:1`

---

## Summary

- The folder defines a clean Interoperability Contract (OpenAPI ⇄ MIDI 2.0), a migration roadmap to a unified runtime, and a JSON Schema for agent descriptors.
- It aligns with the repo’s OpenAPI-first approach and the “MIDI 2.0 everywhere” concept, but needs corrections to match hard rules and to be actionable in CI and code.

## What’s Good

- Self-description and schema parity across protocols are clearly specified: `specs/AGENTS.md:83`.
- Mapping and validation intent (schema hashes, round-trip tests) are sensible and testable.
- Descriptor schema uses JSON Schema 2020‑12 with SemVer and SHA‑256 fields: `specs/schemas/agent-descriptor.schema.json:1`.
- Migration plan is incremental and focuses on real-time semantics while retaining OpenAPI equivalence: `specs/Migration Plan.md:1`.

## Issues & Gaps

- Transport conflict with hard rule (CoreMIDI):
  - Phrasing like “virtual MIDI device” may imply CoreMIDI virtual endpoints, which are prohibited across the repo. Explicitly require midi2 Loopback/RTP/BLE and ban CoreMIDI to align with the hard rule in the workspace root.
- Nonexistent tool references:
  - “fountain-validator” is referenced but not present in-tree: `specs/AGENTS.md:171`, `specs/Migration Plan.md:113`.
- YAML validation commands in README likely won’t work as written:
  - `ajv` CLI does not parse YAML by default; JSON conversion is needed.
  - `python -m jsonschema` also expects JSON, not YAML: `specs/README.md:32`, `specs/README.md:38`.
- Descriptor schema vs narrative mismatch:
  - Narrative “minimal identity block” includes `x-agent-capabilities` as essential, but the schema does not require it. Make it required for consistency: `specs/AGENTS.md:38-45` vs `specs/schemas/agent-descriptor.schema.json:28`.
- Storage/provenance model:
  - README suggests an `agents/` directory for descriptors, but repo’s master plan centralizes prompts/facts in FountainStore. To maintain provenance, descriptors should be seeded and read via FountainStore rather than ad‑hoc files.
- Operational endpoints/registry are not implemented:
  - No services expose `/.well-known/agent-descriptor` yet; no in-tree registry service to index descriptors.
- Latency budgets need qualification:
  - < 5 ms is realistic for host-local Loopback; network transports should be qualified with more conservative SLOs.

## Verification Notes

- Schema validity: JSON Schema 2020‑12; patterns compile; top-level `additionalProperties: false`; required fields present: `x-agent-id`, `x-agent-kind`, `x-agent-version`.
- Patterns:
- `x-agent-id` enforces `fountain.coach/agent/<ns>/<name>`; OK.
  - `gitSHA` allows 7–40 hex; OK.
  - `x-agent-signature` expects 64 hex; OK.
- Inconsistency: `x-agent-capabilities` is optional in schema but treated as minimal identity in the contract.

## Immediate Benefits

- Shared vocabulary for all agents (APIs and instruments) enables deterministic LLM orchestration and discovery.
- Concrete descriptor schema unlocks tooling (lint/validate) and CI checks quickly.
- Migration plan provides a near-term path to reduce network hops and merge real-time and declarative control on one host.

## Long-Term Benefits

- Lower operational cost: fewer servers/containers; one runtime with MIDI 2.0 real-time semantics.
- Better determinism and testability: one semantic bus with recorded UMP and round-trip parity to OpenAPI.
- Cross-platform viability: aligns with midi2 transports; keeps Linux buildability by avoiding CoreMIDI.
- Stronger composability: capabilities become uniformly introspectable entities for planners and LLMs.

## Recommended Fixes / Next Steps

- Transport alignment (hard rule):
  - Update contract and migration language to explicitly prohibit CoreMIDI and require midi2 Loopback/RTP/BLE only (no CoreMIDI). Clarify bridges and host transports.
- Schema tightening:
  - Make `x-agent-capabilities` required; consider a capability ID pattern such as `^[a-z][a-z0-9._-]*$`.
  - Add optional `x-unit` guidance (documented in AGENTS; formalize via schema field/enum if appropriate).
- Validation tooling:
  - Provide working commands for YAML inputs, e.g.: `yq -o=json agents/spectralizer.yaml | npx ajv-cli validate -s specs/schemas/agent-descriptor.schema.json -d -`.
  - Or ship a tiny validator under `Scripts/tools/agent-validate` and wire it into CI.
  - If keeping the “fountain-validator” concept, implement a minimal CLI that performs schema validation + signature/digest; otherwise, remove references.
- Storage and provenance:
  - Align with FountainStore: add a seeder to write descriptors under `page: agent:<id>`, segment `descriptor.json`, and read them at runtime.
  - Update README to discourage `agents/` as canonical storage; prefer store-backed seeders and `store-dump` for inspection.
- Implementation stubs:
  - Add a handler template exposing `GET /.well-known/agent-descriptor` pulling from FountainStore per service package.
  - Use FountainStore as a lightweight “registry” (index page) rather than introducing new infra.
- CI integration:
  - Add a job that validates descriptors (if present) and lints schema usage.
  - Enforce no CoreMIDI usage in bridges/hosts to maintain cross-platform builds.
- Documentation polish:
  - Add “Where” anchors to intended code locations for bridges/host runtime.
  - Qualify latency budgets per transport (host-local vs network) to set realistic SLOs.

---

Status
- Reviewed: 2025-11-11
- Reviewed by: Codex agent
- Base commit: 12d356a
